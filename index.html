<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Chu Kỳ Dao Động Cho Nhà Cao Tầng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: Bổ sung một mục "Bài Nghiên Cứu" hoàn chỉnh, bao gồm toàn bộ nội dung văn bản từ bản thảo đầu tiên. Các mục tương tác (biểu đồ, công cụ tính toán) được giữ nguyên và đặt ở các tab riêng biệt, tạo sự tách bạch rõ ràng giữa phần lý thuyết và phần thực hành. -->
    <!-- Visualization & Content Choices: 1. So sánh Tiêu chuẩn -> Mục tiêu: So sánh -> Trình bày: Biểu đồ cột -> Tương tác: Hiển thị giá trị khi di chuột -> Lý do: Trực quan hóa sự khác biệt trong kết quả tính toán chu kỳ theo các tiêu chuẩn khác nhau cho một công trình giả định, giúp so sánh dễ dàng hơn văn bản thuần túy -> Thư viện: Chart.js (Canvas). 2. Quy trình kiểm soát dao động -> Mục tiêu: Tổ chức -> trình bày: Sơ đồ quy trình -> Tương tác: Không có (tĩnh) -> Lý do: Mô tả một quy trình theo các bước logic, sử dụng các khối và đường nối đơn giản để thể hiện luồng công việc một cách rõ ràng -> Phương pháp: HTML/Tailwind (dùng flexbox và border). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8fafc;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
        }
        .nav-link.active {
            background-color: #0ea5e9;
            color: white;
            transform: translateX(4px);
        }
        .nav-link:not(.active):hover {
            background-color: #f1f5f9;
            transform: translateX(4px);
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 450px;
        }
        .flowchart-step {
            position: relative;
            text-align: center;
            padding: 1rem;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            flex-grow: 1;
        }
        .flowchart-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 5rem;
            height: 2px;
            background-color: #cbd5e1;
            position: relative;
        }
        .flowchart-arrow::after {
            content: '';
            position: absolute;
            right: -1px;
            border: solid #cbd5e1;
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 4px;
            transform: rotate(-45deg);
        }
        @media (max-width: 768px) {
            .flowchart-arrow {
                width: 2px;
                height: 3rem;
                margin-left: auto;
                margin-right: auto;
            }
            .flowchart-arrow::after {
                right: -4px;
                bottom: -1px;
                transform: rotate(45deg);
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="w-full md:w-64 bg-white border-r border-slate-200 p-4 md:p-6 shrink-0">
            <h1 class="text-xl font-bold text-sky-600 mb-6">Nghiên Cứu Dao Động</h1>
            <nav class="flex flex-col space-y-2">
                <a href="#research" data-target="research" class="nav-link active font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">📄</span> Bài Nghiên Cứu
                </a>
                <a href="#factors" data-target="factors" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">📊</span> Yếu tố ảnh hưởng
                </a>
                <a href="#standards" data-target="standards" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">📜</span> Tiêu chuẩn & Giới hạn
                </a>
                <a href="#solutions" data-target="solutions" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">🛠️</span> Giải pháp kiểm soát
                </a>
                <a href="#calculator" data-target="calculator" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">🧮</span> Công cụ tính toán
                </a>
                 <a href="#acceleration" data-target="acceleration" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">💨</span> Tính Gia Tốc Đỉnh
                </a>
                 <a href="#advanced-acceleration" data-target="advanced-acceleration" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">⚡</span> Tính Gia Tốc Đỉnh Nâng Cao
                </a>
                 <a href="#quiz" data-target="quiz" class="nav-link font-semibold p-3 rounded-lg flex items-center">
                    <span class="mr-3">🧠</span> Kiểm Tra
                </a>
                <a href="#summary" id="summary-link" data-target="summary" class="nav-link font-semibold p-3 rounded-lg flex items-center hidden">
                    <span class="mr-3">⭐</span> Tổng hợp kết quả
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-4 md:p-8 lg:p-12 overflow-y-auto">
            <section id="research" class="content-section active">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Nghiên Cứu: Giới Hạn Chu Kỳ Dao Động Của Nhà Cao Tầng</h2>
                <p class="text-lg text-slate-600 mb-6 leading-relaxed">
                    Phân tích chu kỳ dao động riêng (T) là một trong những nhiệm vụ cốt lõi trong thiết kế nhà cao tầng. Chu kỳ này không chỉ quyết định phản ứng của công trình trước tải trọng động như gió và động đất mà còn ảnh hưởng trực tiếp đến trải nghiệm và sự an toàn tâm lý của người sử dụng. Một thiết kế tối ưu phải đạt được sự cân bằng tinh tế giữa các yêu cầu về độ cứng, khối lượng và tính kinh tế.
                </p>

                <h3 class="text-2xl font-bold text-slate-800 mt-8 mb-4">1. Tầm Quan Trọng Của Chu Kỳ Dao Động</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h4 class="font-bold text-sky-600 text-lg mb-2">An Toàn Kết Cấu</h4>
                        <p class="text-slate-600">Chu kỳ dao động là thông số quan trọng nhất để xác định lực động đất tác dụng lên công trình. Nếu chu kỳ dao động của công trình gần với chu kỳ chủ đạo của nền đất, hiện tượng cộng hưởng có thể xảy ra, dẫn đến việc gia tăng đáng kể nội lực và biến dạng, gây ra hư hỏng nghiêm trọng. Các tiêu chuẩn thiết kế thường giới hạn chu kỳ dao động để tránh vùng cộng hưởng nguy hiểm này, đảm bảo công trình có đủ khả năng chống chịu trước các sự kiện địa chấn.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h4 class="font-bold text-sky-600 text-lg mb-2">Tiện Nghi Sử Dụng</h4>
                        <p class="text-slate-600">Đối với nhà cao tầng, dao động do gió có thể gây cảm giác khó chịu cho người sử dụng, ngay cả khi kết cấu vẫn an toàn. Tiêu chuẩn quốc tế và Việt Nam đều đặt ra các giới hạn nghiêm ngặt về chuyển vị ngang và gia tốc dao động ở đỉnh công trình. Các giới hạn này liên quan mật thiết đến chu kỳ dao động và nhằm đảm bảo điều kiện tiện nghi, tránh các cảm giác như chóng mặt, say sóng, và mất an toàn cho cư dân sinh sống và làm việc bên trong.</p>
                    </div>
                </div>

                <h3 class="text-2xl font-bold text-slate-800 mt-8 mb-4">2. Yếu Tố Ảnh Hưởng Đến Chu Kỳ Dao Động</h3>
                <p class="text-lg text-slate-600 mb-6 leading-relaxed">
                    Chu kỳ dao động riêng của một công trình phụ thuộc vào một số yếu tố cơ bản, trong đó quan trọng nhất là **khối lượng** và **độ cứng**. Khối lượng càng lớn, chu kỳ dao động càng dài; độ cứng càng cao, chu kỳ dao động càng ngắn.
                </p>
                <ul class="list-disc list-inside space-y-2 text-slate-600 mb-8">
                    <li>**Chiều cao:** Chu kỳ dao động tỉ lệ thuận với chiều cao của công trình. Công trình càng cao, chu kỳ càng lớn.</li>
                    <li>**Hệ kết cấu:** Đây là yếu tố quyết định độ cứng. Hệ kết cấu vách cứng hoặc lõi cứng có độ cứng lớn hơn nhiều so với hệ khung, dẫn đến chu kỳ dao động ngắn hơn.</li>
                    <li>**Loại vật liệu:** Vật liệu có mô đun đàn hồi (E) cao sẽ làm tăng độ cứng, giảm chu kỳ dao động.</li>
                </ul>

                <h3 class="text-2xl font-bold text-slate-800 mt-8 mb-4">3. Tiêu Chuẩn & Giới Hạn Thiết Kế</h3>
                <p class="text-lg text-slate-600 mb-6 leading-relaxed">
                    Các tiêu chuẩn thiết kế hiện đại (như TCVN 9386, Eurocode 8 hay ASCE 7) đều cung cấp các công thức thực nghiệm để ước tính chu kỳ dao động của công trình, thường dựa trên chiều cao hoặc số tầng. Tuy nhiên, các công thức này chỉ mang tính chất sơ bộ và cần được kiểm tra lại bằng mô hình phân tích chi tiết.
                </p>
                <p class="text-lg text-slate-600 mb-6 leading-relaxed">
                    Các công thức tiêu biểu:
                </p>
                <ul class="list-disc list-inside space-y-2 text-slate-600 mb-8">
                    <li>
                        <span class="font-semibold">TCVN 9386:2012 & Eurocode 8:</span>
                        <p class="mt-1">T1 = Ct x H^(3/4)</p>
                        <p class="text-sm italic text-slate-500">
                            Trong đó: H là chiều cao công trình (m), Ct là hệ số phụ thuộc vào loại kết cấu (0.075 cho khung bê tông cốt thép, 0.085 cho khung thép, 0.050 cho vách hoặc lõi cứng).
                        </p>
                    </li>
                     <li>
                        <span class="font-semibold">ASCE 7-16:</span>
                         <p class="mt-1">Ta = Ct x Hn^x</p>
                         <p class="text-sm italic text-slate-500">
                            Trong đó: Hn là chiều cao công trình (ft hoặc m), Ct và x là các hệ số phụ thuộc vào loại kết cấu và hệ thống chịu lực.
                         </p>
                    </li>
                </ul>

                <h3 class="text-2xl font-bold text-slate-800 mt-8 mb-4">4. Giải Pháp Kiểm Soát Dao Động</h3>
                <p class="text-lg text-slate-600 mb-6 leading-relaxed">
                    Khi kết quả tính toán cho thấy chu kỳ dao động không nằm trong giới hạn cho phép hoặc công trình không thỏa mãn các điều kiện về chuyển vị hay gia tốc, các kỹ sư sẽ áp dụng các giải pháp kiểm soát dao động.
                </p>
                <p class="text-lg text-slate-600 mb-4 leading-relaxed">
                    Có hai phương pháp chính để kiểm soát dao động:
                </p>
                <ul class="list-disc list-inside space-y-2 text-slate-600 mb-8">
                    <li>**Tăng độ cứng của kết cấu:** Bằng cách thêm vách cứng, lõi cứng, hoặc sử dụng hệ kết cấu **outrigger**, các kỹ sư có thể giảm đáng kể chu kỳ dao động của công trình, giúp nó cứng hơn và ít bị biến dạng hơn dưới tác động của tải trọng ngang.</li>
                    <li>**Sử dụng các thiết bị tiêu tán năng lượng:** Các thiết bị này bao gồm **Bộ Giảm Chấn Dao Động (Damper)** và **Khối Dao Động Phụ (TMD - Tuned Mass Damper)**. Các thiết bị này không làm thay đổi độ cứng của công trình mà hoạt động bằng cách hấp thụ và tiêu tán năng lượng dao động, giúp giảm chuyển vị và gia tốc ở đỉnh tháp.</li>
                </ul>
                
                <h3 class="text-2xl font-bold text-slate-800 mt-8 mb-4">Nguồn Tham Khảo</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-600">
                    <li>
                        TCVN 9386:2012, "Thiết kế công trình chịu động đất". Bộ Khoa học và Công nghệ.
                    </li>
                    <li>
                        Eurocode 8 (EN 1998-1:2004), "Design of structures for earthquake resistance". European Committee for Standardization.
                    </li>
                    <li>
                        ASCE/SEI 7-16, "Minimum Design Loads and Associated Criteria for Buildings and Other Structures". American Society of Civil Engineers.
                    </li>
                    <li>
                        Chopra, A. K. (2012). "Dynamics of Structures: Theory and Applications to Earthquake Engineering." 4th Edition. Pearson Education, Inc.
                    </li>
                </ul>
            </section>
            
            <section id="factors" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Yếu tố Ảnh Hưởng</h2>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <p class="text-lg text-slate-600 mb-6">
                        Biểu đồ này giúp bạn trực quan hóa sự tương quan giữa chiều cao công trình và chu kỳ dao động. Bạn có thể thay đổi hệ kết cấu để xem độ cứng ảnh hưởng đến chu kỳ như thế nào.
                    </p>
                    <div class="mb-4">
                        <label class="font-semibold text-slate-700">Chọn hệ kết cấu:</label>
                        <div id="system-selector" class="flex items-center space-x-4 mt-2">
                             <button data-system="rc_frame" class="system-btn active bg-sky-500 text-white px-4 py-2 rounded-lg text-sm font-semibold">Khung BTCT</button>
                             <button data-system="steel_frame" class="system-btn bg-slate-200 text-slate-700 px-4 py-2 rounded-lg text-sm font-semibold">Khung Thép</button>
                             <button data-system="core_wall" class="system-btn bg-slate-200 text-slate-700 px-4 py-2 rounded-lg text-sm font-semibold">Vách Cứng</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="periodChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="standards" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Tiêu Chuẩn & Giới Hạn</h2>
                 <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-sky-600 mb-2">So Sánh Trực Quan</h3>
                        <p class="text-slate-600 text-sm mb-4">Biểu đồ thể hiện chu kỳ dao động (tính bằng giây) cho một tòa nhà cao 200m theo các tiêu chuẩn khác nhau.</p>
                        <div class="chart-container h-[40vh] max-h-[350px]">
                            <canvas id="standardsChart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                            <h4 class="font-bold text-slate-800">TCVN 9386 & Eurocode 8</h4>
                            <p class="text-sm text-slate-600">Sử dụng công thức T = 0.075 x H^(3/4), cho kết quả tương tự nhau, nhấn mạnh vào hệ kết cấu và chiều cao.</p>
                        </div>
                         <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                            <h4 class="font-bold text-slate-800">ASCE 7 (ước tính)</h4>
                            <p class="text-sm text-slate-600">Sử dụng công thức đơn giản T = 0.1 x N (với N là số tầng). Cho một công trình 200m (~60 tầng), kết quả có thể lớn hơn, thể hiện một cách tiếp cận khác dựa trên kinh nghiệm thực tế tại Mỹ.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="solutions" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Giải Pháp Kiểm Soát Dao Động</h2>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <p class="text-lg text-slate-600 mb-6">
                        Sơ đồ này tóm tắt quy trình chung để kiểm soát dao động.
                    </p>
                    <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 w-full">
                        <div class="flowchart-step">
                            <h4 class="font-bold text-sky-600">1. Phân Tích</h4>
                            <p class="text-sm text-slate-500">Mô hình hóa và tính toán</p>
                        </div>
                        <div class="flowchart-arrow"></div>
                        <div class="flowchart-step">
                            <h4 class="font-bold text-sky-600">2. Lựa Chọn</h4>
                            <p class="text-sm text-slate-500">Chọn giải pháp phù hợp</p>
                        </div>
                        <div class="flowchart-arrow"></div>
                        <div class="flowchart-step">
                            <h4 class="font-bold text-sky-600">3. Thiết Kế</h4>
                            <p class="text-sm text-slate-500">Thiết kế và kiểm tra lại</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="calculator" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Công Cụ Tính Toán Sơ Bộ</h2>
                 <p class="text-lg text-slate-600 mb-6">
                    Sử dụng công cụ dưới đây để ước tính nhanh chu kỳ dao động của công trình theo công thức thực nghiệm.
                </p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-sky-600 mb-4">Nhập thông số</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="buildingHeight" class="block font-semibold text-sm mb-1 text-slate-700">Chiều cao công trình (H) (m)</label>
                                <input type="number" id="buildingHeight" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="Ví dụ: 150">
                            </div>
                            <div>
                                <label for="structureType" class="block font-semibold text-sm mb-1 text-slate-700">Hệ chịu lực chính</label>
                                <select id="structureType" class="w-full p-2 border border-slate-300 rounded-md bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                    <option value="0.075">Khung bê tông cốt thép</option>
                                    <option value="0.085">Khung thép</option>
                                    <option value="0.050">Kết cấu khác (vách, hộp)</option>
                                </select>
                            </div>
                            <button id="calculateBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-700 transition-colors">Tính toán</button>
                        </div>
                    </div>
                     <div class="bg-slate-50 p-6 rounded-xl flex flex-col items-center justify-center text-center border-dashed border-2 border-slate-200">
                         <h3 class="font-bold text-lg text-slate-500 mb-2">Kết quả ước tính</h3>
                         <p class="text-4xl md:text-5xl font-bold text-slate-800" id="resultText">0.00 s</p>
                         <p class="text-sm text-slate-500 mt-2">Chu kỳ dao động riêng (T1)</p>
                    </div>
                </div>
            </section>
            
            <section id="acceleration" class="content-section">
                 <h2 class="text-3xl font-bold text-slate-900 mb-4">Tính Gia Tốc Đỉnh</h2>
                 <p class="text-lg text-slate-600 mb-6">
                    Sử dụng công cụ dưới đây để ước tính gia tốc cực đại tại đỉnh công trình.
                </p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-sky-600 mb-4">Nhập thông số</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="periodInput" class="block font-semibold text-sm mb-1 text-slate-700">Chu kỳ dao động (T) (s)</label>
                                <input type="number" id="periodInput" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="Ví dụ: 3.5">
                            </div>
                            <div>
                                <label for="displacementInput" class="block font-semibold text-sm mb-1 text-slate-700">Chuyển vị đỉnh (D) (mm)</label>
                                <input type="number" id="displacementInput" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="Ví dụ: 250">
                            </div>
                            <div>
                                <label for="criteriaSelect" class="block font-semibold text-sm mb-1 text-slate-700">Chọn tiêu chí đánh giá</label>
                                <select id="criteriaSelect" class="w-full p-2 border border-slate-300 rounded-md bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                    <optgroup label="Tiêu chuẩn TCXD 198:1997">
                                        <option value="150">198:1997</option>
                                    </optgroup>
                                    <optgroup label="Tiêu chuẩn ISO 10137">
                                        <option value="15">Khu dân cư (Tiêu chuẩn ISO)</option>
                                        <option value="20">Văn phòng (Tiêu chuẩn ISO)</option>
                                        <option value="40">Trung tâm thương mại (Tiêu chuẩn ISO)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <button id="calculateAccelBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-700 transition-colors">Tính toán</button>
                        </div>
                    </div>
                     <div class="bg-slate-50 p-6 rounded-xl flex flex-col items-center justify-center text-center border-dashed border-2 border-slate-200">
                         <h3 class="font-bold text-lg text-slate-500 mb-2">Kết quả</h3>
                         <p class="text-4xl md:text-5xl font-bold text-slate-800" id="accelerationResult">0.00 mm/s2</p>
                         <p class="text-sm text-slate-500 mt-2">Gia tốc cực đại đỉnh</p>
                         <div id="comparison-result" class="mt-4 p-3 rounded-lg w-full text-center"></div>
                    </div>
                </div>
                
                <div class="mt-10 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-lg text-sky-600 mb-4">Giới Hạn Tiện Nghi</h3>
                     <p class="text-sm text-slate-600 mb-4">
                         Để đảm bảo sự thoải mái cho người sử dụng, các tiêu chuẩn thường đưa ra các giới hạn gia tốc dao động do gió.
                     </p>
                     <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-500 rounded-lg">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                                <tr>
                                    <th scope="col" class="py-3 px-6 rounded-l-lg">Tiêu chí</th>
                                    <th scope="col" class="py-3 px-6">Loại công trình</th>
                                    <th scope="col" class="py-3 px-6 rounded-r-lg">Giới hạn (mm/s2)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b hover:bg-slate-50">
                                    <td class="py-4 px-6 font-semibold text-slate-900">TCXD 198:1997</td>
                                    <td class="py-4 px-6">Tổng quát</td>
                                    <td class="py-4 px-6">150</td>
                                </tr>
                                <tr class="bg-white border-b hover:bg-slate-50">
                                    <td class="py-4 px-6 font-semibold text-slate-900">ISO 10137</td>
                                    <td class="py-4 px-6">Khu dân cư</td>
                                    <td class="py-4 px-6">15</td>
                                </tr>
                                <tr class="bg-white border-b hover:bg-slate-50">
                                    <td class="py-4 px-6 font-semibold text-slate-900"></td>
                                    <td class="py-4 px-6">Văn phòng</td>
                                    <td class="py-4 px-6">20</td>
                                </tr>
                                <tr class="bg-white hover:bg-slate-50">
                                    <td class="py-4 px-6 font-semibold text-slate-900"></td>
                                    <td class="py-4 px-6">Trung tâm thương mại</td>
                                    <td class="py-4 px-6">40</td>
                                </tr>
                            </tbody>
                        </table>
                     </div>
                </div>
            </section>

            <section id="advanced-acceleration" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Tính Gia Tốc Đỉnh Nâng Cao (Annex B.4)</h2>
                <p class="text-lg text-slate-600 mb-6">
                    Công cụ tính toán gia tốc đỉnh theo phương pháp PSD → Modal → F<sub>rms</sub> → a<sub>rms</sub> → k<sub>p</sub> → a<sub>peak</sub>. Kết quả hiển thị bằng <strong>mm/s²</strong>.
                </p>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Left: Inputs -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-sky-600 mb-4">Nhập thông số</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="U" class="block font-semibold text-sm mb-1 text-slate-700">1) Thông số gió: Vận tốc trung bình U (m/s)</label>
                                <input id="U" type="number" value="20" step="0.1" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="Iv" class="block font-semibold text-sm mb-1 text-slate-700">Turbulence intensity I<sub>v</sub> (ví dụ 0.14)</label>
                                <input id="Iv" type="number" value="0.14" step="0.01" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="Lv" class="block font-semibold text-sm mb-1 text-slate-700">Integral scale L<sub>v</sub> (m)</label>
                                <input id="Lv" type="number" value="50" step="1" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="rho" class="block font-semibold text-sm mb-1 text-slate-700">Mật độ không khí ρ (kg/m³)</label>
                                <input id="rho" type="number" value="1.225" step="0.001" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <hr class="my-4">
                            
                            <div>
                                <label for="n1" class="block font-semibold text-sm mb-1 text-slate-700">2) Modal: Tần số modal n₁ (Hz)</label>
                                <input id="n1" type="number" value="0.5" step="0.01" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="m1" class="block font-semibold text-sm mb-1 text-slate-700">Khối lượng modal m₁ (kg)</label>
                                <input id="m1" type="number" value="1000000" step="1000" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="modesCSV" class="block font-semibold text-sm mb-1 text-slate-700">Mode shape (CSV: z:phi, ...). Đỉnh chuẩn hóa = 1</label>
                                <textarea id="modesCSV" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 h-20 font-mono text-sm">0:0.05,10:0.15,20:0.35,40:0.65,80:1.0</textarea>
                                <div class="text-xs text-slate-500 mt-1">Ví dụ: <code class="bg-slate-100 px-1 rounded">0:0.05,10:0.15,20:0.35,40:0.65,80:1.0</code></div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <div>
                                <label for="segmentsCSV" class="block font-semibold text-sm mb-1 text-slate-700">3) Segments (z:area:Cp) (CSV)</label>
                                <textarea id="segmentsCSV" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 h-20 font-mono text-sm">0:10:1.0,20:10:1.0,40:10:1.0,60:10:1.0,80:10:1.0</textarea>
                                <div class="text-xs text-slate-500 mt-1">area (m²), Cp (pressure coefficient)</div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <div>
                                <label for="psdModel" class="block font-semibold text-sm mb-1 text-slate-700">4) PSD model</label>
                                <select id="psdModel" class="w-full p-2 border border-slate-300 rounded-md bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                    <option value="kaimal">Kaimal (mặc định)</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-2">
                                <div>
                                    <label for="fmin" class="block font-semibold text-sm mb-1 text-slate-700">Fmin (Hz)</label>
                                    <input id="fmin" type="number" value="0.01" step="0.01" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                                <div>
                                    <label for="fmax" class="block font-semibold text-sm mb-1 text-slate-700">Fmax (Hz)</label>
                                    <input id="fmax" type="number" value="5" step="0.1" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                                <div>
                                    <label for="df" class="block font-semibold text-sm mb-1 text-slate-700">df (Hz)</label>
                                    <input id="df" type="number" value="0.01" step="0.01" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <div>
                                <label for="sigma_direct" class="block font-semibold text-sm mb-1 text-slate-700">5) Hoặc input trực tiếp σₐ (m/s²) — nếu có</label>
                                <input id="sigma_direct" type="text" placeholder="Ví dụ 0.005" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="Frms_direct" class="block font-semibold text-sm mb-1 text-slate-700">Hoặc input trực tiếp F<sub>rms</sub> (N)</label>
                                <input id="Frms_direct" type="text" placeholder="Ví dụ 5000" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="nu" class="block font-semibold text-sm mb-1 text-slate-700">Up-crossing freq ν (s⁻¹) — để trống lấy ν ≈ n₁</label>
                                <input id="nu" type="number" value="" step="0.01" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div>
                                <label for="T" class="block font-semibold text-sm mb-1 text-slate-700">Thời gian T (s) để tính k<sub>p</sub> (mặc định 600 s)</label>
                                <input id="T" type="number" value="600" step="1" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            </div>
                            
                            <div class="flex gap-2 mt-6">
                                <button id="btnCompute" class="flex-1 bg-sky-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-700 transition-colors">Tính a_peak</button>
                                <button id="btnCSV" class="bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-lg hover:bg-slate-300 transition-colors">Xuất CSV</button>
                                <button id="btnReset" class="bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-lg hover:bg-slate-300 transition-colors">Đặt lại</button>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg mt-4">
                                <p class="text-sm text-blue-800">
                                    <strong>Ghi chú:</strong> Kaimal PSD được sử dụng cho vận tốc dọc gió. Áp lực động xấp xỉ p' ≈ ρ U v' → S_p(f) ≈ (ρ U)² S_v(f). Đây là xấp xỉ cho ước lượng sơ bộ.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right: Results -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-sky-600 mb-4">Kết quả (đơn vị mm/s²)</h3>
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <table class="w-full text-sm">
                                <tbody>
                                    <tr class="border-b border-slate-200">
                                        <td class="py-2 font-semibold text-slate-700">Up-crossing ν (s⁻¹)</td>
                                        <td id="out_nu" class="py-2 text-slate-600">—</td>
                                    </tr>
                                    <tr class="border-b border-slate-200">
                                        <td class="py-2 font-semibold text-slate-700">Peak factor k<sub>p</sub></td>
                                        <td id="out_kp" class="py-2 text-slate-600">—</td>
                                    </tr>
                                    <tr class="border-b border-slate-200">
                                        <td class="py-2 font-semibold text-slate-700">F<sub>rms</sub> (N)</td>
                                        <td id="out_Frms" class="py-2 text-slate-600">—</td>
                                    </tr>
                                    <tr class="border-b border-slate-200">
                                        <td class="py-2 font-semibold text-slate-700">a<sub>rms</sub> (m/s²)</td>
                                        <td id="out_arms" class="py-2 text-slate-600">—</td>
                                    </tr>
                                    <tr class="border-b border-slate-200">
                                        <td class="py-2 font-semibold text-slate-700">a<sub>peak</sub> (m/s²)</td>
                                        <td id="out_apeak_ms2" class="py-2 text-slate-600">—</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 font-bold text-slate-800"><strong>a<sub>peak</sub> (mm/s²)</strong></td>
                                        <td id="out_apeak_mm" class="py-2 font-bold text-sky-600">—</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="mt-4 text-xs text-slate-500" id="notes">Nhấn Tính để chạy.</div>
                        </div>
                        
                        <div class="mt-6">
                            <h4 class="font-semibold text-slate-700 mb-2">Test mẫu</h4>
                            <div class="text-sm text-slate-600">Dữ liệu mặc định sẽ chạy ví dụ sơ bộ; dùng dữ liệu từ ETABS để kết quả chính xác hơn.</div>
                        </div>
                    </div>
                </div>
            </section>

             <section id="quiz" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Kiểm Tra Kiến Thức</h2>
                 <p id="quiz-completion-message" class="text-center text-lg font-medium text-green-700 mb-4 hidden">
                    Chúc mừng! Bạn đã hoàn thành bài kiểm tra. Hãy xem kết quả của bạn ở mục "Tổng hợp kết quả".
                </p>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <div id="quiz-container"></div>
                </div>
            </section>

             <section id="summary" class="content-section">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Tổng Hợp Kết Quả</h2>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center justify-center text-center">
                    <p class="text-xl font-semibold text-slate-600 mb-4">Điểm của bạn:</p>
                    <p class="text-6xl font-extrabold text-sky-600 mb-4" id="score-display">0/5</p>
                    <button id="retake-quiz-btn" class="bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition-colors">
                        Làm lại bài kiểm tra
                    </button>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const systemButtons = document.querySelectorAll('.system-btn');
            const quizCompletionMessage = document.getElementById('quiz-completion-message');
            const summaryLink = document.getElementById('summary-link');
            const scoreDisplay = document.getElementById('score-display');
            const retakeBtn = document.getElementById('retake-quiz-btn');

            let periodChart = null;
            let standardsChart = null;
            let score = 0;
            let questionsAnswered = 0;
            
            // Quiz data
            const quizData = {
              "questions": [
                {
                  "question": "Nếu một kỹ sư muốn RÚT NGẮN chu kỳ dao động riêng của một tòa nhà cao tầng, phương pháp trực tiếp nhất là gì?",
                  "hint": "Hãy nghĩ về mối quan hệ giữa độ cứng và tốc độ dao động. Một cây thước cứng và một cây thước dẻo, cây nào dao động nhanh hơn?",
                  "answerOptions": [
                    {
                      "text": "Tăng độ cứng của hệ kết cấu (ví dụ: thêm vách cứng).",
                      "rationale": "Việc tăng độ cứng của công trình sẽ làm cho nó chống lại biến dạng tốt hơn, dẫn đến dao động nhanh hơn và chu kỳ ngắn hơn.",
                      "isCorrect": true
                    },
                    {
                      "text": "Tăng tổng khối lượng của công trình.",
                      "rationale": "Việc tăng khối lượng, trong khi giữ nguyên độ cứng, sẽ làm tăng quán tính, khiến công trình dao động chậm hơn và có chu kỳ dài hơn.",
                      "isCorrect": false
                    },
                    {
                      "text": "Giảm chiều cao của tòa nhà.",
                      "rationale": "Mặc dù giảm chiều cao sẽ làm giảm chu kỳ, nhưng đây không phải là một 'phương pháp' khả thi trong thực tế thiết kế, mà là một sự thay đổi cơ bản về kiến trúc.",
                      "isCorrect": false
                    },
                    {
                      "text": "Lắp đặt một khối dao động phụ (TMD).",
                      "rationale": "Một TMD được thiết kế để hấp thụ năng lượng và giảm biên độ dao động, chứ không làm thay đổi chu kỳ dao động riêng của kết cấu chính.",
                      "isCorrect": false
                    }
                  ]
                },
                {
                  "question": "Mục đích chính của việc giới hạn chu kỳ dao động trong thiết kế kháng chấn là gì?",
                  "hint": "Hãy xem xét điều gì sẽ xảy ra nếu tần số dao động của tòa nhà trùng với tần số của một trận động đất.",
                  "answerOptions": [
                    {
                      "text": "Để đảm bảo tiện nghi cho người sử dụng.",
                      "rationale": "Tiện nghi cho người sử dụng chủ yếu liên quan đến dao động do gió. Mặc dù có liên quan, nhưng đây không phải là mục đích chính trong thiết kế kháng chấn.",
                      "isCorrect": false
                    },
                    {
                      "text": "Để tránh hiện tượng cộng hưởng nguy hiểm với nền đất.",
                      "rationale": "Nếu chu kỳ của công trình trùng với chu kỳ chủ đạo của nền đất, biên độ dao động có thể tăng lên đột ngột, gây ra hư hỏng nghiêm trọng.",
                      "isCorrect": true
                    },
                    {
                      "text": "Để giảm chi phí xây dựng.",
                      "rationale": "Việc giới hạn chu kỳ dao động thường đòi hỏi kết cấu cứng hơn, điều này có thể làm tăng chi phí xây dựng chứ không phải giảm đi.",
                      "isCorrect": false
                    },
                    {
                      "text": "Để đơn giản hóa quá trình tính toán.",
                      "rationale": "Việc tuân thủ các giới hạn về chu kỳ thường làm cho quá trình phân tích và thiết kế trở nên phức tạp hơn.",
                      "isCorrect": false
                    }
                  ]
                },
                {
                  "question": "Theo công thức thực nghiệm T ≈ 0.075 * H^(3/4), chu kỳ dao động của một tòa nhà khung bê tông cốt thép cao 200m là bao nhiêu?",
                  "hint": "Hãy thay giá trị H = 200 vào công thức và tính toán.",
                  "answerOptions": [
                    {
                      "text": "Khoảng 3.99 giây",
                      "rationale": "Tính toán 0.075 nhân với 200 lũy thừa 0.75 cho ra kết quả gần với giá trị này.",
                      "isCorrect": true
                    },
                    {
                      "text": "Khoảng 2.50 giây",
                      "rationale": "Kết quả này quá nhỏ, có thể do lỗi trong việc tính toán số mũ.",
                      "isCorrect": false
                    },
                    {
                      "text": "Khoảng 5.31 giây",
                      "rationale": "Kết quả này lớn hơn đáng kể, có thể do đã sử dụng một hệ số Ct khác (ví dụ: của khung thép).",
                      "isCorrect": false
                    },
                    {
                      "text": "Khoảng 20.0 giây",
                      "rationale": "Giá trị này không thực tế và có thể là kết quả của việc áp dụng sai công thức, ví dụ như T = 0.1 * H.",
                      "isCorrect": false
                    }
                  ]
                },
                {
                  "question": "Giữa một tòa nhà khung thép và một tòa nhà khung bê tông cốt thép có cùng chiều cao và hình dạng, tòa nhà nào thường có chu kỳ dao động riêng DÀI HƠN?",
                  "hint": "Hãy xem xét hệ số Ct trong công thức thực nghiệm cho hai loại kết cấu này.",
                  "answerOptions": [
                    {
                      "text": "Tòa nhà khung thép.",
                      "rationale": "Kết cấu thép thường nhẹ hơn và 'mềm' hơn so với kết cấu bê tông cốt thép có cùng khả năng chịu lực, dẫn đến chu kỳ dao động dài hơn.",
                      "isCorrect": true
                    },
                    {
                      "text": "Tòa nhà khung bê tông cốt thép.",
                      "rationale": "Kết cấu bê tông cốt thép thường có độ cứng lớn hơn và nặng hơn, dẫn đến chu kỳ dao động ngắn hơn.",
                      "isCorrect": false
                    },
                    {
                      "text": "Cả hai có chu kỳ như nhau.",
                      "rationale": "Mặc dù có cùng chiều cao, nhưng vật liệu và hệ kết cấu khác nhau sẽ dẫn đến các đặc tính động lực học khác nhau.",
                      "isCorrect": false
                    },
                    {
                      "text": "Không thể xác định nếu không có phân tích chi tiết.",
                      "rationale": "Mặc dù phân tích chi tiết là cần thiết cho thiết kế cuối cùng, nhưng về mặt nguyên tắc chung, kết cấu thép có xu hướng 'mềm' hơn.",
                      "isCorrect": false
                    }
                  ]
                },
                {
                  "question": "Chức năng chính của hệ kết cấu 'outrigger' trong nhà cao tầng là gì?",
                  "hint": "Hệ thống này kết nối lõi trung tâm với các cột biên. Điều này ảnh hưởng đến khả năng chống lại lực ngang như thế nào?",
                  "answerOptions": [
                    {
                      "text": "Tăng đáng kể độ cứng ngang của công trình.",
                      "rationale": "Outrigger hoạt động như những cánh tay đòn khổng lồ, huy động các cột biên tham gia vào việc chống lại mô men uốn do tải trọng ngang, làm tăng độ cứng tổng thể.",
                      "isCorrect": true
                    },
                    {
                      "text": "Giảm tải trọng tĩnh thẳng đứng.",
                      "rationale": "Hệ thống outrigger chủ yếu dùng để chống lại tải trọng ngang và không có tác dụng đáng kể trong việc giảm tải trọng tĩnh.",
                      "isCorrect": false
                    },
                    {
                      "text": "Hấp thụ năng lượng dao động.",
                      "rationale": "Đây là chức năng của các thiết bị như damper hoặc TMD. Outrigger tăng độ cứng chứ không tiêu tán năng lượng.",
                      "isCorrect": false
                    },
                    {
                      "text": "Tăng tính thẩm mỹ cho kiến trúc.",
                      "rationale": "Mặc dù có thể được thể hiện ra bên ngoài, nhưng chức năng chính của outrigger là về kết cấu, không phải thẩm mỹ.",
                      "isCorrect": false
                    }
                  ]
                }
              ]
            };

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function renderQuiz() {
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = '';
                questionsAnswered = 0;
                score = 0;
                quizCompletionMessage.classList.add('hidden');
                summaryLink.classList.add('hidden');

                quizData.questions.forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'mb-6 p-4 border rounded-lg shadow-sm bg-slate-50';
                    
                    const questionText = document.createElement('p');
                    questionText.className = 'font-semibold text-lg mb-4 text-slate-800';
                    questionText.textContent = `Câu ${index + 1}: ${q.question}`;
                    questionDiv.appendChild(questionText);

                    const shuffledOptions = shuffleArray([...q.answerOptions]);
                    
                    shuffledOptions.forEach(option => {
                        const optionButton = document.createElement('button');
                        optionButton.className = 'w-full text-left p-3 mb-2 rounded-lg border-2 border-slate-200 hover:bg-slate-100 transition-colors duration-200 text-slate-700';
                        optionButton.textContent = option.text;
                        optionButton.onclick = () => {
                            if (optionButton.disabled) return;
                            
                            const allOptions = questionDiv.querySelectorAll('button');
                            allOptions.forEach(btn => btn.disabled = true);

                            const rationaleP = document.createElement('p');
                            rationaleP.className = 'text-sm mt-2 p-2 rounded-lg';
                            rationaleP.textContent = option.rationale;

                            if (option.isCorrect) {
                                score++;
                                optionButton.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                                rationaleP.classList.add('bg-green-50', 'text-green-600');
                            } else {
                                optionButton.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                                rationaleP.classList.add('bg-red-50', 'text-red-600');
                                
                                const correctOption = shuffledOptions.find(opt => opt.isCorrect);
                                const correctButton = Array.from(allOptions).find(btn => btn.textContent === correctOption.text);
                                if(correctButton) {
                                     correctButton.classList.remove('bg-slate-100', 'border-slate-200', 'text-slate-700');
                                     correctButton.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                                }
                            }
                             questionDiv.appendChild(rationaleP);
                             questionsAnswered++;
                             if (questionsAnswered === quizData.questions.length) {
                                 quizCompletionMessage.classList.remove('hidden');
                                 summaryLink.classList.remove('hidden');
                             }
                        };
                        questionDiv.appendChild(optionButton);
                    });
                    quizContainer.appendChild(questionDiv);
                });
            }

            function renderSummary() {
                 scoreDisplay.textContent = `${score}/${quizData.questions.length}`;
            }

            retakeBtn.addEventListener('click', () => {
                renderQuiz();
                setActiveLink('quiz');
            });

            const setActiveLink = (targetId) => {
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.dataset.target === targetId);
                });
                contentSections.forEach(section => {
                    section.classList.toggle('active', section.id === targetId);
                });

                if (targetId === 'factors' && !periodChart) {
                    initPeriodChart();
                }
                if (targetId === 'standards' && !standardsChart) {
                    initStandardsChart();
                }
                if (targetId === 'quiz') {
                    renderQuiz();
                }
                 if (targetId === 'summary') {
                    renderSummary();
                }
                if (targetId === 'advanced-acceleration') {
                    // Initialize advanced acceleration calculator when tab is opened
                    if (typeof $ !== 'undefined' && $('btnReset')) {
                        $('btnReset').click();
                    }
                }
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = e.currentTarget.dataset.target;
                    setActiveLink(targetId);
                    window.location.hash = targetId;
                });
            });

            const initialTarget = window.location.hash.substring(1) || 'research';
            setActiveLink(initialTarget);
            
            const chartData = {
                heights: Array.from({ length: 21 }, (_, i) => i * 20),
                systems: {
                    rc_frame: { label: 'Khung BTCT', ct: 0.075, borderColor: 'rgb(14, 165, 233)', backgroundColor: 'rgba(14, 165, 233, 0.1)' },
                    steel_frame: { label: 'Khung Thép', ct: 0.085, borderColor: 'rgb(249, 115, 22)', backgroundColor: 'rgba(249, 115, 22, 0.1)' },
                    core_wall: { label: 'Vách Cứng', ct: 0.05, borderColor: 'rgb(22, 163, 74)', backgroundColor: 'rgba(22, 163, 74, 0.1)' },
                },
                calculatePeriods: function(systemKey) {
                    const ct = this.systems[systemKey].ct;
                    return this.heights.map(h => h > 0 ? ct * Math.pow(h, 0.75) : 0);
                }
            };
            
            function initPeriodChart(systemKey = 'rc_frame') {
                if (periodChart) periodChart.destroy();
                const systemConfig = chartData.systems[systemKey];
                const chartDataset = {
                    label: systemConfig.label,
                    data: chartData.calculatePeriods(systemKey),
                    borderColor: systemConfig.borderColor,
                    backgroundColor: systemConfig.backgroundColor,
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2,
                    pointBackgroundColor: systemConfig.borderColor,
                };

                const ctx = document.getElementById('periodChart').getContext('2d');
                periodChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: chartData.heights, datasets: [chartDataset] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Chiều cao công trình (m)', font: { size: 14 } }, grid: { display: false } },
                            y: { title: { display: true, text: 'Chu kỳ dao động (s)', font: { size: 14 } }, beginAtZero: true }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                callbacks: {
                                    title: (tooltipItems) => `Cao độ: ${tooltipItems[0].label} m`,
                                    label: (context) => `${context.dataset.label}: ${context.parsed.y.toFixed(2)} s`
                                }
                            }
                        }
                    }
                });
            }
            
            function updatePeriodChart(systemKey) {
                if (!periodChart) return;
                const systemConfig = chartData.systems[systemKey];
                periodChart.data.datasets[0] = {
                    label: systemConfig.label,
                    data: chartData.calculatePeriods(systemKey),
                    borderColor: systemConfig.borderColor,
                    backgroundColor: systemConfig.backgroundColor,
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2,
                    pointBackgroundColor: systemConfig.borderColor,
                };
                periodChart.update();
            }

            systemButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const systemKey = e.currentTarget.dataset.system;
                    updatePeriodChart(systemKey);
                    systemButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-sky-500', 'text-white');
                        btn.classList.add('bg-slate-200', 'text-slate-700');
                    });
                    e.currentTarget.classList.add('active', 'bg-sky-500', 'text-white');
                    e.currentTarget.classList.remove('bg-slate-200', 'text-slate-700');
                });
            });

            function initStandardsChart() {
                if(standardsChart) standardsChart.destroy();
                const ctx = document.getElementById('standardsChart').getContext('2d');
                standardsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['TCVN 9386:2012', 'Eurocode 8', ['ASCE 7-16', '(ước tính)']],
                        datasets: [{
                            label: 'Chu kỳ dao động (s)',
                            data: [3.99, 3.99, 6.0],
                            backgroundColor: ['rgba(14, 165, 233, 0.7)', 'rgba(22, 163, 74, 0.7)', 'rgba(249, 115, 22, 0.7)'],
                            borderColor: ['rgb(14, 165, 233)', 'rgb(22, 163, 74)', 'rgb(249, 115, 22)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: { title: { display: true, text: 'Chu kỳ (s)' }, beginAtZero: true },
                            y: { grid: { display: false } }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    title: function(tooltipItems) {
                                        const label = tooltipItems[0].label;
                                        return Array.isArray(label) ? label.join(' ') : label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const heightInput = document.getElementById('buildingHeight');
            const typeSelect = document.getElementById('structureType');
            const calcBtn = document.getElementById('calculateBtn');
            const resultText = document.getElementById('resultText');

            calcBtn.addEventListener('click', () => {
                const H = parseFloat(heightInput.value);
                const Ct = parseFloat(typeSelect.value);

                if (isNaN(H) || H <= 0) {
                    resultText.textContent = "Lỗi!";
                    return;
                }
                const T = Ct * Math.pow(H, 0.75);
                resultText.textContent = `${T.toFixed(2)} s`;
            });
            
            const periodInput = document.getElementById('periodInput');
            const displacementInput = document.getElementById('displacementInput');
            const calculateAccelBtn = document.getElementById('calculateAccelBtn');
            const accelerationResult = document.getElementById('accelerationResult');
            const comparisonResult = document.getElementById('comparison-result');
            const criteriaSelect = document.getElementById('criteriaSelect');
            
            calculateAccelBtn.addEventListener('click', () => {
                const T = parseFloat(periodInput.value);
                const D_mm = parseFloat(displacementInput.value);
                const limit = parseFloat(criteriaSelect.value);
                const selectedText = criteriaSelect.options[criteriaSelect.selectedIndex].text;
                
                if (isNaN(T) || isNaN(D_mm) || T <= 0 || D_mm <= 0 || isNaN(limit)) {
                    accelerationResult.innerHTML = "Lỗi!";
                    comparisonResult.className = 'mt-4 p-3 rounded-lg w-full text-center text-red-700 bg-red-100';
                    comparisonResult.innerHTML = "Vui lòng nhập các giá trị hợp lệ.";
                    return;
                }
                
                // The formula for acceleration is a = w^2 * D, where w = 2*pi/T
                const a_max_mm = (4 * Math.PI * Math.PI / (T * T)) * D_mm;
                
                accelerationResult.innerHTML = `${a_max_mm.toFixed(2)} mm/s2`;
                
                let message = "";
                let className = "";
                
                if (a_max_mm <= limit) {
                    message = `Kết quả tốt! Gia tốc nằm trong giới hạn cho phép của tiêu chí '${selectedText}'.`;
                    className = "text-green-700 bg-green-100";
                } else {
                    message = `Kết quả vượt quá giới hạn cho phép (${limit} mm/s2) của tiêu chí '${selectedText}'.`;
                    className = "text-red-700 bg-red-100";
                }
                
                comparisonResult.className = `mt-4 p-3 rounded-lg w-full text-center ${className}`;
                comparisonResult.innerHTML = message;
            });

            // Advanced Acceleration Calculator Functions
            const $ = id => document.getElementById(id);

            /* parse CSV z:val, or z:area:Cp */
            function parsePairsCSV(text, expectFields=2) {
                const parts = text.split(',').map(s=>s.trim()).filter(s=>s.length>0);
                const out = [];
                for (let p of parts) {
                    const fields = p.split(':').map(x=>x.trim());
                    if (fields.length >= expectFields) {
                        if (expectFields === 2) out.push({z: parseFloat(fields[0]), v: parseFloat(fields[1])});
                        else out.push({z: parseFloat(fields[0]), area: parseFloat(fields[1]), Cp: parseFloat(fields[2])});
                    }
                }
                out.sort((a,b)=>a.z-b.z);
                return out;
            }

            /* Kaimal PSD for along-wind velocity */
            function S_v_kaimal(f, U, Iv, Lv) {
                const sigma_u = Iv * U;
                const x = 6 * f * Lv / Math.max(1e-9, U);
                const denom = Math.pow(1 + x, 5/3);
                return 4 * sigma_u * sigma_u * (Lv / Math.max(1e-9, U)) / denom;
            }

            /* coherence exponential */
            function coherence_exp(f, dz, U, c_coh=8) {
                return Math.exp(-c_coh * f * Math.abs(dz) / Math.max(1e-9, U));
            }

            function compute_kp(nu, T) {
                const val = Math.max(1e-6, nu * T);
                const s = Math.sqrt(2 * Math.log(val));
                if (!isFinite(s) || s <= 0) return 3.0;
                return s + 0.6 / s;
            }

            function trapz(x,y) {
                let s=0;
                for (let i=1;i<x.length;i++) s += 0.5*(y[i]+y[i-1])*(x[i]-x[i-1]);
                return s;
            }

            function compute_all() {
                // read
                const U = parseFloat($('U').value) || 0;
                const Iv = parseFloat($('Iv').value) || 0;
                const Lv = parseFloat($('Lv').value) || 0;
                const rho = parseFloat($('rho').value) || 1.225;
                const n1 = parseFloat($('n1').value) || 0;
                const m1 = parseFloat($('m1').value) || 0;
                const modesCSV = $('modesCSV').value.trim();
                const segsCSV = $('segmentsCSV').value.trim();
                const fmin = parseFloat($('fmin').value) || 0.01;
                const fmax = parseFloat($('fmax').value) || 5;
                const df = parseFloat($('df').value) || 0.01;
                const sigma_direct = $('sigma_direct').value.trim();
                const Frms_direct = $('Frms_direct').value.trim();
                const nu_input_raw = $('nu').value.trim();
                const T_input = parseFloat($('T').value) || 600;

                // direct cases
                if (sigma_direct !== '') {
                    const sigma_a = parseFloat(sigma_direct);
                    const nu = nu_input_raw === '' ? Math.max(1e-6, n1) : parseFloat(nu_input_raw) || n1;
                    const kp = compute_kp(nu, T_input);
                    const a_peak = kp * sigma_a;
                    return {kp, Frms:null, a_rms:sigma_a, a_peak, a_peak_mm: a_peak*1000, nu};
                }
                if (Frms_direct !== '') {
                    const Frms = parseFloat(Frms_direct);
                    const omega = 2*Math.PI*n1;
                    const a_rms = (m1 > 0 && omega>0) ? Frms / (m1 * omega * omega) : 0;
                    const nu = nu_input_raw === '' ? Math.max(1e-6, n1) : parseFloat(nu_input_raw) || n1;
                    const kp = compute_kp(nu, T_input);
                    const a_peak = kp * a_rms;
                    return {kp, Frms, a_rms, a_peak, a_peak_mm: a_peak*1000, nu};
                }

                // PSD-> modal force
                const modePts = parsePairsCSV(modesCSV,2);
                if (modePts.length < 2) { alert('Mode shape không hợp lệ.'); throw 'bad mode'; }
                const segs = parsePairsCSV(segsCSV,3);
                if (segs.length < 1) { alert('Segments không hợp lệ.'); throw 'bad seg'; }

                // phi at segment heights (linear interp)
                const zs = segs.map(s=>s.z);
                function interpPhi(z) {
                    for (let p of modePts) if (Math.abs(p.z - z) < 1e-6) return p.v;
                    for (let i=0;i<modePts.length-1;i++){
                        const a=modePts[i], b=modePts[i+1];
                        if (z > a.z && z < b.z) {
                            const t = (z-a.z)/(b.z-a.z);
                            return a.v + t*(b.v - a.v);
                        }
                    }
                    if (z <= modePts[0].z) return modePts[0].v;
                    return modePts[modePts.length-1].v;
                }
                const phi_seg = segs.map(s => interpPhi(s.z));
                const area_seg = segs.map(s => s.area || 0);
                const Cp_seg = segs.map(s => s.Cp || 1.0);

                // freq vector
                const freqs = [];
                for (let f=fmin; f<=fmax+1e-12; f+=df) freqs.push(Number(f.toFixed(8)));
                const Nf = freqs.length;

                // S_v
                const S_v = freqs.map(f => S_v_kaimal(f, U, Iv, Lv));
                // S_p
                const Sp = S_v.map(sv => (rho * U)*(rho * U) * sv);

                // modal weighting w_i = Cp_i * A_i * phi_i
                const w = segs.map((s,i) => ( (Cp_seg[i] || 1) * (area_seg[i] || 0) * (phi_seg[i] || 0) ));

                // S_F(f)
                const S_F = new Array(Nf).fill(0);
                for (let k=0;k<Nf;k++){
                    const f = freqs[k];
                    let sum = 0;
                    for (let i=0;i<w.length;i++){
                        for (let j=0;j<w.length;j++){
                            const wij = w[i]*w[j];
                            const coh = coherence_exp(f, Math.abs(segs[i].z - segs[j].z), U, 8.0);
                            sum += wij * coh;
                        }
                    }
                    S_F[k] = Sp[k] * sum;
                }

                // integrate S_F to var_F
                const varF = trapz(freqs, S_F);
                const Frms = Math.sqrt(Math.max(0,varF));
                // a_rms
                const omega = 2*Math.PI*n1;
                const a_rms = (m1 > 0 && omega > 0) ? Frms / (m1 * omega * omega) : 0;

                const nu = nu_input_raw === '' ? Math.max(1e-6, n1) : parseFloat(nu_input_raw) || n1;
                const kp = compute_kp(nu, T_input);
                const a_peak = kp * a_rms;
                return {kp, Frms, a_rms, a_peak, a_peak_mm: a_peak*1000, nu, details:{varF, Nf}};
            }

            function render(res) {
                $('out_nu').innerText = res.nu ? res.nu.toFixed(4) : '—';
                $('out_kp').innerText = res.kp ? res.kp.toFixed(4) : '—';
                $('out_Frms').innerText = res.Frms ? res.Frms.toFixed(3) : '—';
                $('out_arms').innerText = res.a_rms ? res.a_rms.toFixed(6) : '—';
                $('out_apeak_ms2').innerText = res.a_peak ? res.a_peak.toFixed(6) : '—';
                $('out_apeak_mm').innerText = res.a_peak_mm ? res.a_peak_mm.toFixed(3) + ' mm/s²' : '—';
                $('notes').innerText = res.details ? 'Chi tiết: ' + JSON.stringify(res.details) : '';
            }

            // Advanced acceleration calculator event listeners
            $('btnCompute').addEventListener('click', function(){
                try {
                    const res = compute_all();
                    render(res);
                } catch (e) {
                    console.error(e);
                    alert('Lỗi khi tính: ' + e);
                }
            });

            $('btnReset').addEventListener('click', function(){
                $('U').value='20'; $('Iv').value='0.14'; $('Lv').value='50'; $('rho').value='1.225';
                $('n1').value='0.5'; $('m1').value='1000000';
                $('modesCSV').value='0:0.05,10:0.15,20:0.35,40:0.65,80:1.0';
                $('segmentsCSV').value='0:10:1.0,20:10:1.0,40:10:1.0,60:10:1.0,80:10:1.0';
                $('fmin').value='0.01'; $('fmax').value='5'; $('df').value='0.01';
                $('sigma_direct').value=''; $('Frms_direct').value=''; $('nu').value=''; $('T').value='600';
                $('out_nu').innerText='—'; $('out_kp').innerText='—'; $('out_Frms').innerText='—';
                $('out_arms').innerText='—'; $('out_apeak_ms2').innerText='—'; $('out_apeak_mm').innerText='—';
                $('notes').innerText='Nhấn Tính để chạy';
            });

            $('btnCSV').addEventListener('click', function(){
                const rows = [
                    ['U','Iv','Lv','rho','n1','m1','modesCSV','segsCSV','Frms','a_rms_m_s2','a_peak_m_s2','a_peak_mm_s2'],
                    [$('U').value,$('Iv').value,$('Lv').value,$('rho').value,$('n1').value,$('m1').value,$('modesCSV').value,$('segmentsCSV').value,$('out_Frms').innerText,$('out_arms').innerText,$('out_apeak_ms2').innerText,$('out_apeak_mm').innerText]
                ];
                const csv = rows.map(r=>r.join(',')).join('\n');
                const blob = new Blob([csv], {type:'text/csv'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'annexB4_peak_mm_s2.csv'; a.click(); URL.revokeObjectURL(url);
            });

            // Initialize advanced acceleration calculator
            $('btnReset').click();
        });
    </script>
</body>
</html>
